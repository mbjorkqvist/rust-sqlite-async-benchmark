<!DOCTYPE html>
<html>
<head>
    <title>SQLite Async Benchmark Results</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --text-primary: #eee;
            --text-secondary: #aaa;
            --accent-cyan: #00d4ff;
            --accent-green: #00ff88;
            --color-direct: #ff6384;
            --color-spawn: #36a2eb;
            --color-tokio: #4bc0c0;
        }
        
        * { box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
        }
        
        h1 {
            color: var(--accent-cyan);
            border-bottom: 2px solid var(--accent-cyan);
            padding-bottom: 10px;
        }
        
        h2 {
            color: var(--accent-green);
            margin-top: 40px;
        }
        
        .intro {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        .intro ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .intro li {
            margin: 5px 0;
        }
        
        .chart-container {
            width: 100%;
            max-width: 900px;
            margin: 20px auto;
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 10px;
        }
        
        canvas {
            background: var(--bg-secondary);
        }
        
        .config-table {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        table {
            border-collapse: collapse;
            width: 100%;
            max-width: 600px;
        }
        
        th, td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid #333;
        }
        
        th {
            color: var(--accent-cyan);
        }
        
        .timestamp {
            color: var(--text-secondary);
            font-size: 0.9em;
        }
        
        footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #333;
            color: var(--text-secondary);
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <h1>SQLite Async Benchmark Results</h1>
    
    <div class="intro">
        <p>Comparing three approaches to SQLite operations in async Rust:</p>
        <ul>
            <li><strong style="color: var(--color-direct)">Direct Blocking</strong> - SQLite calls made directly (blocks Tokio workers)</li>
            <li><strong style="color: var(--color-spawn)">spawn_blocking</strong> - Wrapped in tokio::task::spawn_blocking()</li>
            <li><strong style="color: var(--color-tokio)">tokio-rusqlite</strong> - Dedicated thread per database</li>
        </ul>
    </div>

    <div class="config-table">
        <h3>Test Configuration</h3>
        <table>
            <tr><th>Parameter</th><th>Value</th></tr>
            <tr><td>Generated</td><td id="timestamp">-</td></tr>
            <tr><td>Worker Threads</td><td id="workers">-</td></tr>
            <tr><td>Readers per DB</td><td id="readers">-</td></tr>
            <tr><td>Test Duration</td><td id="duration">-</td></tr>
        </table>
    </div>

    <div id="charts-container">
        <!-- Charts will be dynamically inserted here -->
    </div>

    <footer>
        <p>Generated by sqlite-async-benchmark</p>
        <p>To regenerate charts from CSV: <code>cargo run --release --bin plot -- --csv &lt;path/to/benchmark.csv&gt;</code></p>
    </footer>

    <script>
        // Chart.js configuration
        const chartColors = {
            direct: { bg: 'rgba(255, 99, 132, 0.8)', border: 'rgb(255, 99, 132)' },
            spawn: { bg: 'rgba(54, 162, 235, 0.8)', border: 'rgb(54, 162, 235)' },
            tokio: { bg: 'rgba(75, 192, 192, 0.8)', border: 'rgb(75, 192, 192)' }
        };

        const commonOptions = {
            responsive: true,
            plugins: {
                legend: { labels: { color: '#eee' } }
            },
            scales: {
                x: {
                    ticks: { color: '#aaa' },
                    grid: { color: '#333' }
                },
                y: {
                    ticks: { color: '#aaa' },
                    grid: { color: '#333' }
                }
            }
        };

        function createBarChart(canvasId, title, labels, directData, spawnData, tokioData, yLabel) {
            const ctx = document.getElementById(canvasId).getContext('2d');
            return new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Direct Blocking',
                            data: directData,
                            backgroundColor: chartColors.direct.bg,
                            borderColor: chartColors.direct.border,
                            borderWidth: 1
                        },
                        {
                            label: 'spawn_blocking',
                            data: spawnData,
                            backgroundColor: chartColors.spawn.bg,
                            borderColor: chartColors.spawn.border,
                            borderWidth: 1
                        },
                        {
                            label: 'tokio-rusqlite',
                            data: tokioData,
                            backgroundColor: chartColors.tokio.bg,
                            borderColor: chartColors.tokio.border,
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    ...commonOptions,
                    plugins: {
                        ...commonOptions.plugins,
                        title: {
                            display: true,
                            text: title,
                            color: '#eee',
                            font: { size: 16 }
                        }
                    },
                    scales: {
                        ...commonOptions.scales,
                        x: {
                            ...commonOptions.scales.x,
                            title: { display: true, text: 'Number of Databases', color: '#eee' }
                        },
                        y: {
                            ...commonOptions.scales.y,
                            title: { display: true, text: yLabel, color: '#eee' }
                        }
                    }
                }
            });
        }

        // Data will be injected here by the Rust program
        // BENCHMARK_DATA_PLACEHOLDER
    </script>
</body>
</html>

